<!DOCTYPE html>

<html>
	<head>
		<title> Cars </title>
		<meta charset = 'UTF-8'>
	</head>

	<body>
		<form onsubmit='submitHandler(event)' id="form">
			<label for="input1">Data</label><br>
			<input type="text" id="nameInput" name="name" placeholder="Enter any data for car" ><br>
                                      
			<label for="input2">Keywords</label><br>
			<input type="text" id="keywordInput" name="keyword" placeholder="Enter keyword for accident" ><br>


			<input  type="submit" value="ok">
                        <button onclick="replace()" >to create</button> 
			<div id="info"></div>
                        <div id="resultInfo">
				<p></p>
				
                                <li id="name">
					<li id="year"> </li>
				</li>
                        </div>
		</form>

		<script src='datas.js'></script>
	        <script>
		
		let apiCall = async (api) => {
		  const apiRoot = "https://652297e7-74e2-485b-9e4d-752866994db4.mock.pstmn.io";	
                  const request = `${apiRoot}${api}`;
                  console.log(request);
                  let response = await fetch(request);
                  let json = await response.json();
                  return json;
                }
                let allCars = apiCall('/cars');
		document.body.onload = () => addInfo(allCars);
                        
		function addInfo(a) {
		 a.then((val) => {
                 console.log(val);
		   for(let i = 0; i < val.length;i++){
		   const div = document.createElement('div');
                   const datas = document.createElement('ul');    
                   datas.innerHTML = Object.values(val[i]);
                   div.appendChild(datas);
		   document.getElementById('resultInfo').appendChild(div);
		   }
		 });
		};

               let dat = document.getElementById('nameInput').value;
               let word = document.getElementById('keywordInput').value;
               function submitHandler(event) {		       
	        event.preventDefault();
		searchByDatas(dat);
	        searchByAccident(word);
		remove();       
	        };

               function searchByDatas(data){
		       if ((data == "white") && data){
                         result = apiCall('/cars?color=white');
			       addInfo(result);}
		        else if ((data == "black") && data){
                               result = apiCall('/cars?color=black');
				addInfo(result);
			       } 
		       else if ((data == "brown") && data){
                               result = apiCall('/cars?color=brown');
			       addInfo(result);
		       }
                }
                function searchByAccident(keyword){
			if ((keyword == "bla") && keyword){
                         result = apiCall('/cars?accident=bla');
		         addInfo(result);
			}
		        else if ((keyword == "flooded") && keyword){
                        result = apiCall('/cars?accident=flooded');
			addInfo(result);
			}
                        else if ((keyword == "crushed") && keyword){
                        result = apiCall('/cars?accident=cushed');
			addInfo(result);
			}
			else if ((keyword == "not accidental") && keyword){
                        result = apiCall('/cars?accident=dont');
			addInfo(result);
			}
		};
                function remove(){
		let elem = document.getElementById('info');
		elem.parentNode.removeChild(elem);	
		};  

                function replace() {
			location.replace('./newindex.html');
		 }
		</script>
	</body>
</html>
